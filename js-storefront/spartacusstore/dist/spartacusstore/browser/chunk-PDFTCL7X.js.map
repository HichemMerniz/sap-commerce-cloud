{"version":3,"sources":["node_modules/@spartacus/tracking/fesm2022/spartacus-tracking-personalization-core.mjs","node_modules/@spartacus/tracking/fesm2022/spartacus-tracking-personalization.mjs"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { NgModule, inject, isDevMode, Injectable } from '@angular/core';\nimport * as i2 from '@spartacus/core';\nimport { LoggerService } from '@spartacus/core';\nimport { EMPTY } from 'rxjs';\nimport { filter, map } from 'rxjs/operators';\nimport * as i1 from '@spartacus/tracking/personalization/root';\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass PersonalizationCoreModule {\n  static {\n    this.ɵfac = function PersonalizationCoreModule_Factory(t) {\n      return new (t || PersonalizationCoreModule)();\n    };\n  }\n  static {\n    this.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n      type: PersonalizationCoreModule\n    });\n  }\n  static {\n    this.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({});\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(PersonalizationCoreModule, [{\n    type: NgModule,\n    args: [{}]\n  }], null, null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass PersonalizationContextService {\n  constructor(config, cmsService) {\n    this.config = config;\n    this.cmsService = cmsService;\n    this.logger = inject(LoggerService);\n  }\n  getPersonalizationContext() {\n    if (!this.config.personalization?.context) {\n      if (isDevMode()) {\n        this.logger.warn(`There is no context configured in Personalization.`);\n      }\n      return EMPTY;\n    } else {\n      const context = this.config.personalization.context;\n      return this.cmsService.getCurrentPage().pipe(filter(Boolean), map(page => page.slots?.[context.slotPosition]), filter(Boolean), map(slot => {\n        const scriptComponent = slot.components?.find(i => i.uid === context.componentId);\n        return this.buildPersonalizationContext(scriptComponent?.properties?.script?.data);\n      }));\n    }\n  }\n  buildPersonalizationContext(data) {\n    if (data) {\n      const context = JSON.parse(atob(data));\n      context.actions.forEach(action => {\n        Object.keys(action).forEach(key => {\n          action[key] = atob(action[key]);\n        });\n      });\n      for (let i = 0; i < context.segments.length; i++) {\n        context.segments[i] = atob(context.segments[i]);\n      }\n      return context;\n    }\n  }\n  static {\n    this.ɵfac = function PersonalizationContextService_Factory(t) {\n      return new (t || PersonalizationContextService)(i0.ɵɵinject(i1.PersonalizationConfig), i0.ɵɵinject(i2.CmsService));\n    };\n  }\n  static {\n    this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: PersonalizationContextService,\n      factory: PersonalizationContextService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(PersonalizationContextService, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], () => [{\n    type: i1.PersonalizationConfig\n  }, {\n    type: i2.CmsService\n  }], null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PersonalizationContextService, PersonalizationCoreModule };\n","import * as i0 from '@angular/core';\nimport { NgModule } from '@angular/core';\nimport { PersonalizationCoreModule } from '@spartacus/tracking/personalization/core';\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass PersonalizationModule {\n  static {\n    this.ɵfac = function PersonalizationModule_Factory(t) {\n      return new (t || PersonalizationModule)();\n    };\n  }\n  static {\n    this.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n      type: PersonalizationModule\n    });\n  }\n  static {\n    this.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n      imports: [PersonalizationCoreModule]\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(PersonalizationModule, [{\n    type: NgModule,\n    args: [{\n      imports: [PersonalizationCoreModule]\n    }]\n  }], null, null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n/*\n * Public API Surface of personalizatiion\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PersonalizationModule };\n"],"mappings":"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","names":[],"x_google_ignoreList":[0,1]}
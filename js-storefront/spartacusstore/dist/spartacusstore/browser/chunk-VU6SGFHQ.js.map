{"version":3,"sources":["node_modules/@spartacus/smartedit/fesm2022/spartacus-smartedit-root.mjs"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { Injectable, inject, APP_INITIALIZER, NgModule } from '@angular/core';\nimport * as i3 from '@spartacus/core';\nimport { Config, FeatureModulesService, RoutingService, provideDefaultConfig } from '@spartacus/core';\nimport * as i2 from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { take, switchMap } from 'rxjs/operators';\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass SmartEditConfig {\n  static {\n    this.ɵfac = function SmartEditConfig_Factory(t) {\n      return new (t || SmartEditConfig)();\n    };\n  }\n  static {\n    this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: SmartEditConfig,\n      factory: function SmartEditConfig_Factory(t) {\n        let r = null;\n        if (t) {\n          r = new (t || SmartEditConfig)();\n        } else {\n          r = i0.ɵɵinject(Config);\n        }\n        return r;\n      },\n      providedIn: 'root'\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(SmartEditConfig, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root',\n      useExisting: Config\n    }]\n  }], null, null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nconst SMART_EDIT_FEATURE = 'smartEdit';\n\n/**\n * The SmartEditLauncherService is used to check whether Spartacus is launched inside Smart Edit;\n * it also gets cmsTicketId sent from Smart Edit.\n */\nclass SmartEditLauncherService {\n  get cmsTicketId() {\n    return this._cmsTicketId;\n  }\n  constructor(config, location, scriptLoader) {\n    this.config = config;\n    this.location = location;\n    this.scriptLoader = scriptLoader;\n    this.featureModulesService = inject(FeatureModulesService);\n  }\n  /**\n   * load webApplicationInjector.js first when Spartacus launched inside SmartEdit\n   */\n  load() {\n    if (this.isLaunchedInSmartEdit()) {\n      this.featureModulesService.resolveFeature(SMART_EDIT_FEATURE).subscribe();\n      this.scriptLoader?.embedScript({\n        src: 'assets/webApplicationInjector.js',\n        params: undefined,\n        attributes: {\n          id: 'text/smartedit-injector',\n          'data-smartedit-allow-origin': this.config.smartEdit?.allowOrigin\n        }\n      });\n    }\n  }\n  /**\n   * Indicates whether Spartacus is launched in SmartEdit\n   */\n  isLaunchedInSmartEdit() {\n    const path = this.location.path().split('?')[0];\n    const params = this.location.path().split('?')[1];\n    const cmsToken = params?.split('&').find(param => param.startsWith('cmsTicketId='));\n    this._cmsTicketId = cmsToken?.split('=')[1];\n    return path.split('/').pop() === this.config.smartEdit?.storefrontPreviewRoute && !!this._cmsTicketId;\n  }\n  static {\n    this.ɵfac = function SmartEditLauncherService_Factory(t) {\n      return new (t || SmartEditLauncherService)(i0.ɵɵinject(SmartEditConfig), i0.ɵɵinject(i2.Location), i0.ɵɵinject(i3.ScriptLoader));\n    };\n  }\n  static {\n    this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: SmartEditLauncherService,\n      factory: SmartEditLauncherService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(SmartEditLauncherService, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], () => [{\n    type: SmartEditConfig\n  }, {\n    type: i2.Location\n  }, {\n    type: i3.ScriptLoader\n  }], null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nconst defaultSmartEditConfig = {\n  smartEdit: {\n    storefrontPreviewRoute: 'cx-preview',\n    allowOrigin: 'localhost:9002'\n  }\n};\nclass CmsTicketInterceptor {\n  constructor(service) {\n    this.service = service;\n    this.routingService = inject(RoutingService);\n  }\n  intercept(request, next) {\n    const cmsTicketId = this.service.cmsTicketId;\n    if (!cmsTicketId) {\n      return next.handle(request);\n    }\n    if (request.url.includes('/productList')) {\n      return this.setRequestForProductListPage(request, next, cmsTicketId);\n    }\n    if (request.url.includes('/cms/') || request.url.includes('/products/')) {\n      request = request.clone({\n        setParams: {\n          cmsTicketId\n        }\n      });\n    }\n    return next.handle(request);\n  }\n  setRequestForProductListPage(request, next, cmsTicketId) {\n    return this.routingService.getPageContext().pipe(take(1), switchMap(pageContext => {\n      request = request.clone(!!pageContext.id ? {\n        setParams: {\n          cmsTicketId,\n          categoryCode: pageContext.id\n        }\n      } : {\n        setParams: {\n          cmsTicketId\n        }\n      });\n      return next.handle(request);\n    }));\n  }\n  static {\n    this.ɵfac = function CmsTicketInterceptor_Factory(t) {\n      return new (t || CmsTicketInterceptor)(i0.ɵɵinject(SmartEditLauncherService));\n    };\n  }\n  static {\n    this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: CmsTicketInterceptor,\n      factory: CmsTicketInterceptor.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(CmsTicketInterceptor, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], () => [{\n    type: SmartEditLauncherService\n  }], null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nconst interceptors = [{\n  provide: HTTP_INTERCEPTORS,\n  useExisting: CmsTicketInterceptor,\n  multi: true\n}];\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nfunction smartEditFactory(smartEditLauncherService) {\n  const isReady = () => {\n    smartEditLauncherService.load();\n  };\n  return isReady;\n}\nclass SmartEditRootModule {\n  static {\n    this.ɵfac = function SmartEditRootModule_Factory(t) {\n      return new (t || SmartEditRootModule)();\n    };\n  }\n  static {\n    this.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n      type: SmartEditRootModule\n    });\n  }\n  static {\n    this.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n      providers: [...interceptors, provideDefaultConfig(defaultSmartEditConfig), {\n        provide: APP_INITIALIZER,\n        useFactory: smartEditFactory,\n        deps: [SmartEditLauncherService],\n        multi: true\n      }]\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(SmartEditRootModule, [{\n    type: NgModule,\n    args: [{\n      providers: [...interceptors, provideDefaultConfig(defaultSmartEditConfig), {\n        provide: APP_INITIALIZER,\n        useFactory: smartEditFactory,\n        deps: [SmartEditLauncherService],\n        multi: true\n      }]\n    }]\n  }], null, null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { CmsTicketInterceptor, SMART_EDIT_FEATURE, SmartEditConfig, SmartEditLauncherService, SmartEditRootModule, smartEditFactory };\n"],"mappings":"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","names":[],"x_google_ignoreList":[0]}
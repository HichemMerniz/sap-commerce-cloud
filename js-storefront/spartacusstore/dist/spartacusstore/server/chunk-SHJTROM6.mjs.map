{"version":3,"sources":["node_modules/@spartacus/cart/fesm2022/spartacus-cart-base-components-mini-cart.mjs"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { Injectable, Component, ChangeDetectionStrategy, NgModule } from '@angular/core';\nimport * as i1 from '@spartacus/cart/base/root';\nimport { CreateCartEvent } from '@spartacus/cart/base/root';\nimport * as i2 from '@spartacus/core';\nimport { StorageSyncType, BASE_SITE_CONTEXT_ID, UrlModule, I18nModule, provideDefaultConfig } from '@spartacus/core';\nimport { of, combineLatest } from 'rxjs';\nimport { startWith, map, switchMap, distinctUntilChanged, takeWhile } from 'rxjs/operators';\nimport * as i3 from '@spartacus/storefront';\nimport { ICON_TYPE, IconModule } from '@spartacus/storefront';\nimport * as i2$1 from '@angular/router';\nimport { RouterModule } from '@angular/router';\nimport * as i4 from '@angular/common';\nimport { CommonModule } from '@angular/common';\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nconst _c0 = () => ({\n  cxRoute: \"cart\"\n});\nconst _c1 = a0 => ({\n  count: a0\n});\nconst _c2 = a0 => ({\n  total: a0\n});\nclass MiniCartComponentService {\n  constructor(activeCartFacade, authService, statePersistenceService, siteContextParamsService, eventService) {\n    this.activeCartFacade = activeCartFacade;\n    this.authService = authService;\n    this.statePersistenceService = statePersistenceService;\n    this.siteContextParamsService = siteContextParamsService;\n    this.eventService = eventService;\n  }\n  /**\n   * This function supports lazy loading of the cart functionality's code. We only call\n   * the activeCartFacade if we know there is actually a cart.\n   * Without a cart, we can return a default value and\n   * avoid loading the cart library code.\n   */\n  getQuantity() {\n    return this.activeCartRequired().pipe(switchMap(activeCartRequired => {\n      if (activeCartRequired) {\n        return this.activeCartFacade.getActive().pipe(startWith({\n          totalUnitCount: 0\n        }), map(cart => cart.totalUnitCount || 0));\n      } else {\n        return of(0);\n      }\n    }));\n  }\n  /**\n   * This function supports lazy loading of the cart functionality's code. We only call\n   * the activeCartFacade if we know there is actually a cart.\n   * Without a cart, we can return a default value and\n   * avoid loading the cart library code.\n   */\n  getTotalPrice() {\n    return this.activeCartRequired().pipe(switchMap(activeCartRequired => {\n      if (activeCartRequired) {\n        return this.activeCartFacade.getActive().pipe(map(cart => cart.totalPrice?.formattedValue ?? ''));\n      } else {\n        return of('');\n      }\n    }));\n  }\n  /**\n   * This function determines if it is required to get active cart data from ActiveCartFacade.\n   * It is required to call the ActiveCartFacade if one of these criteria is met:\n   * - There is an active cart id in the browser local storage\n   * - A user is authenticated\n   * - The cart library code chunk with the ActiveCartFacade implementation is already loaded.\n   *\n   * Once the observable returned by activeCartRequired emits true, it completes.\n   * activeCartRequired helps to make the mini cart compatible with some level of lazy loading.\n   */\n  activeCartRequired() {\n    return combineLatest([this.hasActiveCartInStorage(), this.authService.isUserLoggedIn(), this.isCartCreated()]).pipe(map(([hasCartInStorage, isUserLoggedIn, isCartCreated]) => hasCartInStorage || isUserLoggedIn || isCartCreated), distinctUntilChanged(), takeWhile(hasCart => !hasCart, true));\n  }\n  hasActiveCartInStorage() {\n    return this.getCartStateFromBrowserStorage().pipe(map(state => Boolean(state?.active)));\n  }\n  isCartCreated() {\n    return this.eventService.get(CreateCartEvent).pipe(map(_ => true), startWith(false));\n  }\n  getCartStateFromBrowserStorage() {\n    return this.siteContextParamsService.getValues([BASE_SITE_CONTEXT_ID]).pipe(map(context => {\n      return this.statePersistenceService.readStateFromStorage({\n        key: 'cart',\n        context: context,\n        storageType: StorageSyncType.LOCAL_STORAGE\n      });\n    }));\n  }\n  static {\n    this.ɵfac = function MiniCartComponentService_Factory(t) {\n      return new (t || MiniCartComponentService)(i0.ɵɵinject(i1.ActiveCartFacade), i0.ɵɵinject(i2.AuthService), i0.ɵɵinject(i2.StatePersistenceService), i0.ɵɵinject(i2.SiteContextParamsService), i0.ɵɵinject(i2.EventService));\n    };\n  }\n  static {\n    this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: MiniCartComponentService,\n      factory: MiniCartComponentService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MiniCartComponentService, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], () => [{\n    type: i1.ActiveCartFacade\n  }, {\n    type: i2.AuthService\n  }, {\n    type: i2.StatePersistenceService\n  }, {\n    type: i2.SiteContextParamsService\n  }, {\n    type: i2.EventService\n  }], null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass MiniCartComponent {\n  constructor(miniCartComponentService) {\n    this.miniCartComponentService = miniCartComponentService;\n    this.iconTypes = ICON_TYPE;\n    this.quantity$ = this.miniCartComponentService.getQuantity();\n    this.total$ = this.miniCartComponentService.getTotalPrice();\n  }\n  static {\n    this.ɵfac = function MiniCartComponent_Factory(t) {\n      return new (t || MiniCartComponent)(i0.ɵɵdirectiveInject(MiniCartComponentService));\n    };\n  }\n  static {\n    this.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n      type: MiniCartComponent,\n      selectors: [[\"cx-mini-cart\"]],\n      decls: 13,\n      vars: 29,\n      consts: [[3, \"routerLink\"], [3, \"type\"], [1, \"total\"], [1, \"count\"]],\n      template: function MiniCartComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"a\", 0);\n          i0.ɵɵpipe(1, \"cxUrl\");\n          i0.ɵɵpipe(2, \"async\");\n          i0.ɵɵpipe(3, \"cxTranslate\");\n          i0.ɵɵelement(4, \"cx-icon\", 1);\n          i0.ɵɵelementStart(5, \"span\", 2);\n          i0.ɵɵtext(6);\n          i0.ɵɵpipe(7, \"async\");\n          i0.ɵɵpipe(8, \"cxTranslate\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"span\", 3);\n          i0.ɵɵtext(10);\n          i0.ɵɵpipe(11, \"async\");\n          i0.ɵɵpipe(12, \"cxTranslate\");\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"routerLink\", i0.ɵɵpipeBind1(1, 5, i0.ɵɵpureFunction0(22, _c0)));\n          i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind2(3, 9, \"miniCart.item\", i0.ɵɵpureFunction1(23, _c1, i0.ɵɵpipeBind1(2, 7, ctx.quantity$))));\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"type\", ctx.iconTypes.CART);\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(8, 14, \"miniCart.total\", i0.ɵɵpureFunction1(25, _c2, i0.ɵɵpipeBind1(7, 12, ctx.total$))), \" \");\n          i0.ɵɵadvance(4);\n          i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(12, 19, \"miniCart.count\", i0.ɵɵpureFunction1(27, _c1, i0.ɵɵpipeBind1(11, 17, ctx.quantity$))), \" \");\n        }\n      },\n      dependencies: [i2$1.RouterLink, i3.IconComponent, i4.AsyncPipe, i2.UrlPipe, i2.TranslatePipe],\n      encapsulation: 2,\n      changeDetection: 0\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MiniCartComponent, [{\n    type: Component,\n    args: [{\n      selector: 'cx-mini-cart',\n      changeDetection: ChangeDetectionStrategy.OnPush,\n      template: \"<a\\n  [attr.aria-label]=\\\"\\n    'miniCart.item' | cxTranslate: { count: quantity$ | async }\\n  \\\"\\n  [routerLink]=\\\"{ cxRoute: 'cart' } | cxUrl\\\"\\n>\\n  <cx-icon [type]=\\\"iconTypes.CART\\\"></cx-icon>\\n\\n  <span class=\\\"total\\\">\\n    {{ 'miniCart.total' | cxTranslate: { total: total$ | async } }}\\n  </span>\\n\\n  <span class=\\\"count\\\">\\n    {{ 'miniCart.count' | cxTranslate: { count: quantity$ | async } }}\\n  </span>\\n</a>\\n\"\n    }]\n  }], () => [{\n    type: MiniCartComponentService\n  }], null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\nclass MiniCartModule {\n  static {\n    this.ɵfac = function MiniCartModule_Factory(t) {\n      return new (t || MiniCartModule)();\n    };\n  }\n  static {\n    this.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n      type: MiniCartModule\n    });\n  }\n  static {\n    this.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n      providers: [provideDefaultConfig({\n        cmsComponents: {\n          MiniCartComponent: {\n            component: MiniCartComponent\n          }\n        }\n      })],\n      imports: [CommonModule, RouterModule, UrlModule, IconModule, I18nModule]\n    });\n  }\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MiniCartModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CommonModule, RouterModule, UrlModule, IconModule, I18nModule],\n      providers: [provideDefaultConfig({\n        cmsComponents: {\n          MiniCartComponent: {\n            component: MiniCartComponent\n          }\n        }\n      })],\n      declarations: [MiniCartComponent],\n      exports: [MiniCartComponent]\n    }]\n  }], null, null);\n})();\n\n/*\n * SPDX-FileCopyrightText: 2024 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { MiniCartComponent, MiniCartComponentService, MiniCartModule };\n"],"mappings":"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","names":[],"x_google_ignoreList":[0]}